
SELECT * FROM 
	cursos c 
INNER JOIN tipocursos t  ON c.idTipoCurso = t.idTipoCurso;

-- Hacemos el Join para traernos la info de tipos de cursos en Cursos
-- Esto es lo mismo pero solo con los datos que queremos que nos muestre
SELECT 	c.codigo,
		c.anio, 
		c.idTipoCurso,
		tc.nombre,
		profesores 
FROM cursos c
INNER JOIN tipocursos tc ON tc.idTipoCurso = c.idTipoCurso; 
	-- para utilixar solo los campos que queremos utilizamos los alias
	-- en la tabla para traer los campos que precisamos.. 
	-- y hacer la union de las 2 tablas

	-- Alias: (renombrar una tabla o campo para que sea mas facil de manipular)

-- En esta consulta lo que hicimos juntamos con (group by) todos los registros "idTipoCurso"
-- y despues contamos cuantos cuantos Cursos habia en cada idTipoCurso 
SELECT 	c.idTipoCurso,
		tc.nombre,
		count(codigo)AS total
FROM cursos c
INNER JOIN tipocursos tc ON tc.idTipoCurso = c.idTipoCurso 
	GROUP BY c.idTipoCurso;

		
CREATE TABLE alumnos_cursos(
		documento varchar (20),
		codigo int (7),
		KEY (documento),
		KEY (codigo),
		CONSTRAINT c_alumCurso_fk1 FOREIGN KEY (documento) REFERENCES alumnos (documento),
		CONSTRAINT c_alumCurso_fk2 FOREIGN KEY (codigo) REFERENCES cursos (codigo)
)

SHOW tables; 
SELECT * FROM alumnos_cursos;
SELECT * FROM alumnos;
SELECT * FROM cursos c;

-- agregamos lineas en alumnos_cursos (respetendo que sea un doc de alumno y un codigo que esté)
INSERT INTO alumnos_cursos SET
	documento = "34996652",
	codigo = "4";

INSERT INTO alumnos_cursos SET
	documento = "4455895",
	codigo = "3";

INSERT INTO alumnos_cursos SET
	documento = "bb4885895",
	codigo = "6";

INSERT INTO alumnos_cursos SET
	documento = "4455225",
	codigo = "3";

INSERT INTO alumnos_cursos SET
	documento = "966695",
	codigo = "7";


-- 34996652 mario alumno
 -- en esta consulta sacamos que curso esta dando que profesores 
SELECT	c.codigo,
		c.anio, 
		c.idTipoCurso,
		tc.nombre,
		concat(p.nombre," ",p.apellidos, " ",p.documento) AS nombre_completo
	FROM cursos c
	INNER JOIN tipocursos tc ON tc.idTipoCurso = c.idTipoCurso
	INNER JOIN profesores p ON p.documento = c.profesores;


-- 1ero armamos la consulta para tener los alumnos que cursos hicieron
SELECT *FROM alumnos_cursos;

-- 2do devolvimos solo los campos de la consulta
SELECT	ac.documento,
		ac.codigo
	FROM alumnos_cursos ac;

-- 3ero anexamos alumnos a la consulta y concatenar el nombre completo y la fechaNacimiento
SELECT  ac.documento,
		concat (a.nombre," ",a.apellido) AS nombreCompleto,
		a.fechaNacimiento,
		ac.codigo
FROM alumnos_cursos ac
INNER JOIN alumnos a ON a.documento = ac.documento;

-- 4 anexamos los cursos a la consulta agregando el idTipoCurso y anio 
SELECT  ac.documento,
		concat (a.nombre," ",a.apellido) AS nombreCompleto,
		a.fechaNacimiento,
		ac.codigo,
		c.anio, 
		c.idTipoCurso 
FROM alumnos_cursos ac
INNER JOIN alumnos a ON a.documento = ac.documento
INNER JOIN cursos c ON  c.codigo = ac.codigo

-- 5 anexamos a la consulta tiposcursos a igualando contra cursos los idtipocursos
SELECT  ac.documento,
		concat (a.nombre," ",a.apellido) AS nombreCompleto,
		a.fechaNacimiento,
		ac.codigo,
		c.anio, 
		t.nombre
FROM alumnos_cursos ac
INNER JOIN alumnos a ON a.documento = ac.documento
INNER JOIN cursos c ON  c.codigo = ac.codigo
INNER JOIN tipocursos t ON t.idTipoCurso =c.idTipoCurso 

-- 6) Buscamos los que hicieron los cursos Excel intermedio
SELECT  ac.documento,
		concat (a.nombre," ",a.apellido) AS nombreCompleto,
		a.fechaNacimiento,
		ac.codigo,
		c.anio, 
		t.nombre
FROM alumnos_cursos ac
INNER JOIN alumnos a ON a.documento = ac.documento
INNER JOIN cursos c ON  c.codigo = ac.codigo
INNER JOIN tipocursos t ON t.idTipoCurso =c.idTipoCurso 
WHERE t.nombre LIKE ("%Excel intermedio%");

-- 7) Total de alumnos que tuvieron cada anio
	SELECT	
		c.anio,
		count(ac.documento) AS totalAlumno	 
	FROM alumnos_cursos ac
	INNER JOIN alumnos a ON a.documento = ac.documento
	INNER JOIN cursos c ON c.codigo = ac.codigo
	INNER JOIN tipocursos t ON t.idTipoCurso = c.idTipoCurso 
	GROUP BY anio;

-- 8 Total de alumnos por anio y curso
SELECT 
	c.anio,
	t.nombre,
	count(ac.documento) AS totalAlumno
	FROM alumnos_cursos ac
	INNER JOIN alumnos a ON a.documento = ac.documento
	INNER JOIN cursos c ON c.codigo = ac.codigo
	INNER JOIN tipocursos t ON t.idTipoCurso = c.idTipoCurso
		WHERE a.fechaNacimiento <date_format(date_sub(now(), INTERVAL 20 year), "%Y-%m-%d")
	GROUP BY c.anio,c.idTipoCurso;
	
-- 9) resto 20 años a la fecha desde ahora (now)
	SELECT now(); 
	SELECT date_sub(now(), INTERVAL 20 YEAR);

	SELECT date_format(date_sub(now(), INTERVAL 20 year), "%Y-%m-%d");
	-- 2002-05-10

SELECT 
	c.anio,
	concat (a.nombre," ",apellido) AS nombreCompleto,
	date_format(a.fechaNacimiento, "%d/%m/%y") 
	FROM alumnos_cursos ac
	INNER JOIN alumnos a ON a.documento = ac.documento
	INNER JOIN cursos c ON c.codigo = ac.codigo
	INNER JOIN tipocursos t ON t.idTipoCurso = c.idTipoCurso
		WHERE c.anio = "2000"
		AND a.fechaNacimiento < date_format(date_sub(now(), INTERVAL 20 year), "%Y-%m-%d")
		
	-- 10- 9) alumnos que cursaron entre 2005 y 2010 pero unicos 
SELECT 
	a.documento,
	concat (a.nombre," ",a.apellido) AS nombreCompleto
	FROM alumnos_cursos ac
	INNER JOIN alumnos a ON a.documento = ac.documento
	INNER JOIN cursos c ON c.codigo = ac.codigo
	INNER JOIN tipocursos t ON t.idTipoCurso = c.idTipoCurso
		WHERE c.anio BETWEEN "2005"  AND "2010"
		GROUP BY a.documento ;
		
	-- Clausula Distinct alumnos que cursaron entre 2005 y 2010 pero unicos
SELECT DISTINCT 
	a.documento,
	concat (a.nombre," ",a.apellido) AS nombreCompleto
	FROM alumnos_cursos ac
	INNER JOIN alumnos a ON a.documento = ac.documento
	INNER JOIN cursos c ON c.codigo = ac.codigo
	INNER JOIN tipocursos t ON t.idTipoCurso = c.idTipoCurso
		WHERE c.anio BETWEEN "2005"  AND "2010" ;
			
SELECT 
	a.documento,
	concat (a.nombre," ",a.apellido) AS nombreCompleto,
	count(c.codigo) as totalRealizados,
	group_concat(c.codigo) AS cursosRealizados 
	FROM alumnos_cursos ac
	INNER JOIN alumnos a ON a.documento = ac.documento
	INNER JOIN cursos c ON c.codigo = ac.codigo
	INNER JOIN tipocursos t ON t.idTipoCurso = c.idTipoCurso
		WHERE c.anio BETWEEN "2005"  AND "2010"
		GROUP BY a.documento	
		HAVING totalRealizados >1;